{% extends "admin/layout.html.twig" %}

{% block panel %}
    {% if pattern != "*" %}
        <h1>Keys matching <code>{{ pattern }}</code></h1>
        <p><strong>{{ num_keys }} out of <strong>{{ dbsize }}</strong> matched</strong></p>
    {% else %}
        <h1>All Keys</h1>
        <p><strong>{{ num_keys }} Keys available</strong></p>
    {% endif %}

    <nav class="navbar navbar-default" role="navigation">

        <form class="navbar-form navbar-left" role="search" method="GET" action="/admin/service">
            <div class="form-group">
                <input name="provider" type="text" class="form-control" value="redis" style="display: none">
                <input name="panel" type="text" class="form-control" value="keys" style="display: none">
                <input name="pattern" type="text" class="form-control" placeholder="{{ pattern }}"
                       value="{{ pattern }}">
            </div>
            <button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span> Search
            </button>
            <button type="reset" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Reset</button>
        </form>
    </nav>

    <table class="table table-hover">
        <thead>
        <tr>
            <th class="text-right">#</th>
            <th class="text-center">Type</th>
            <th class="text-left">Key</th>
            <th class=""></th>
        </tr>
        </thead>
        <tbody>
        {% for key in keys %}
            <tr>
                <td class="text-right" style="width: 5%">{{ loop.index + (offset * perpage) }}</td>
                <td class="text-center">{{ types[key] }}</td>
                <td class="text-left">
                    <a href="/admin/service?provider=redis&panel=key&key={{ key|escape('url') }}">{{ key }}</a>
                </td>
                <td class="text-right">
                    <form method="post">
                        <input type="hidden" name="action" value="delkey"/>
                        <input type="hidden" name="key" value="{{ key }}"/>
                        <button class="btn btn-default" type="submit"
                                onclick="return confirm('Are you sure you want to delete this key? {{ key }}');">
                            <span class="glyphicon glyphicon-trash"></span>
                        </button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% if num_keys > perpage %}
        <div class="text-center">
            {{ include('layout/pagination.html.twig', {
                currentPage: offset,
                lastPage: ((num_keys/perpage) | round(0,'ceil')),
                paginationPath: '/admin/service?provider=redis&panel=keys&perpage=' ~ perpage ~ '&pattern=' ~ (pattern | escape('url'))
            }) }}
        </div>
    {% endif %}

{% endblock %}
