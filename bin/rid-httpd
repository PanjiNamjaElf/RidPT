#!/usr/bin/env php
<?php
/**
 * RidPT - Yet Another Private Bittorrent Service
 *
 * @package RidPT
 * @author Rhilip <rhilipruan@gmail.com>
 */

define('RIDPT_ROOT', dirname(__DIR__));
define('RIDPT_START', microtime(true));

/*
 * --------------------------------------------------------------------------
 * Register The Auto Loader
 * --------------------------------------------------------------------------
 *
 * Composer provides a convenient, automatically generated class loader for
 * our application. We just need to utilize it! We'll simply require it
 * into the script here so that we don't have to worry about manual
 * loading any of our classes later on. It feels great to relax.
 *
*/
require RIDPT_ROOT . '/vendor/autoload.php';

/*
 * --------------------------------------------------------------------------
 * Check Environment of PHP
 * --------------------------------------------------------------------------
 *
 * RidPT framework based on Swoole extension, which can only be used from
 * the CLI SAPI.
 *
 * @see https://wiki.swoole.com/wiki/page/760.html
 *
 */
if (!PHP_SAPI === 'cli') {
    throw new RuntimeException(
        'Fatal error: The swoole project should be invoked via the CLI version of PHP, not the ' . PHP_SAPI . ' SAPI'
    );
}

/*
 * --------------------------------------------------------------------------
 * Load Environment variables
 * --------------------------------------------------------------------------
 *
 * phpdotenv provides a automagically loader for
 * Loads environment variables from .env to getenv(), $_ENV and $_SERVER
 * So we can then use env($name = null, $default = '') to get environment
 * variables quickly and simply.
 *
 */
$dotenv = Dotenv\Dotenv::create(RIDPT_ROOT);
$dotenv->load();  // $dotenv->overload();

/*
 * --------------------------------------------------------------------------
 * FIXME Start Console Application
 * --------------------------------------------------------------------------
 */
$config = require RIDPT_ROOT . '/config/httpd.php';
var_dump($config);
$exitCode = (new Rid\Console\Application($config))->run();
exit($exitCode);
